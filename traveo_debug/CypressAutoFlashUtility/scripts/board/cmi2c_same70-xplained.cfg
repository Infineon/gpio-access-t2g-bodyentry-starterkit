source [find board/atmel_same70_xplained.cfg]

# M24C04
flash bank $_CHIPNAME.m24c04 cmspi 0x90000000 0 0 0 $_TARGETNAME \
	0x004 0x400E1238 30 0x3DC 0x3D8 0x40000000 0x400E1438 26 0x3DC 0x3D8 0x04000000

# M24C16
flash bank $_CHIPNAME.m24c16 cmspi 0x90000200 0 0 0 $_TARGETNAME \
	0x004 0x400E1438 30 0x3DC 0x3D8 0x40000000 0x400E1238 31 0x3DC 0x3D8 0x80000000

# M24C32
flash bank $_CHIPNAME.m24c32 cmspi 0x90000A00 0 0 0 $_TARGETNAME \
	0x004 0x400E0E38  2 0x3DC 0x3D8 0x00000004 0x400E1238 13 0x3DC 0x3D8 0x00002000

# M24256
flash bank $_CHIPNAME.m24256 cmspi 0x90001A00 0 0 0 $_TARGETNAME \
	0x004 0x400E0E38  5 0x3DC 0x3D8 0x00000020 0x400E1438 26 0x3DC 0x3D8 0x04000000

# AT24C512
flash bank $_CHIPNAME.at24c512 cmspi 0x90009A00 0 0 0 $_TARGETNAME \
	0x004 0x400E0E38 19 0x3DC 0x3D8 0x00080000 0x400E1238 31 0x3DC 0x3D8 0x80000000

# M24M02
flash bank $_CHIPNAME.m24m02 cmspi 0x90019A00 0 0 0 $_TARGETNAME \
	0x004 0x400E0E38  6 0x3DC 0x3D8 0x00000040 0x400E1238 13 0x3DC 0x3D8 0x00002000

# MB85RC16
flash bank $_CHIPNAME.mb85rc16 cmspi 0x90059A00 0 0 0 $_TARGETNAME \
	0x004 0x400E1438 11 0x3DC 0x3D8 0x00000800 0x400E1438 26 0x3DC 0x3D8 0x04000000

# FM24CL64B
flash bank $_CHIPNAME.fm24cl64b cmspi 0x9005A200 0 0 0 $_TARGETNAME \
	0x004 0x400E1438 27 0x3DC 0x3D8 0x08000000 0x400E1238 31 0x3DC 0x3D8 0x80000000

# FM24V02
flash bank $_CHIPNAME.fm24v02 cmspi 0x9005C200 0 0 0 $_TARGETNAME \
	0x004 0x400E1238 19 0x3DC 0x3D8 0x00080000 0x400E1238 13 0x3DC 0x3D8 0x00002000

# AT24MAC402, lower half
flash bank $_CHIPNAME.at24mac402l cmspi 0xA0000000 0 0 0 $_TARGETNAME \
	0x004 0x400E0E38  3 0x3DC 0x3D8 0x00000008 0x400E0E38  4 0x3DC 0x3D8 0x00000010

# AT24MAC402, upper half
flash bank $_CHIPNAME.at24mac402h cmspi 0xA0000100 0 0 0 $_TARGETNAME \
	0x004 0x400E0E38  3 0x3DC 0x3D8 0x00000008 0x400E0E38  4 0x3DC 0x3D8 0x00000010

proc cmi2c_init { } {
	# disable watchdog
	mww 0x400E1854 0x3FFFAFFF	;# WDT_MR: WDIS=1

	# disable write protection
	mww 0x400E06E4 0x504D4300	;# PMC_WPMR: WPEN=0

	# main on-chip rc oscillator at 8 MHz
	mww 0x400E0620 0x00371018	;# CKGR_MOR: MOSCSEL=0, MOSCXTST=16, MOSCRCF=0x1, MOSCRCEN=1

	# set PLLA output to 200 MHz
	mww 0x400E0628 0x20180A01	;# CKGR_PLLAR: MULA=24, PLLACOUNT=10, DIVA=1
	sleep 1

	# setup prescalers
	mww 0x400E0630 0x00000101	;# PMC_MCKR: MDIC=/2, PRES=/1, CSS=MAIN_CLK
	sleep 1

	# switch to PLLA
	mww 0x400E0630 0x00000102	;# PMC_MCKR: MDIC=/2, PRES=/1, CSS=PLLA_CLK

	# enable PIO clocks: PIDs 10-12, 16-17 refer to PIOA-E
	mww 0x400E0610 0x00031C00	;# PMC_PCER0 = PID17|PID16|PID12|PID11|PID10

	adapter_khz 4000

	# M24C04, A5=SDA: PC30, A0=SCL: PD26
	# PC30:INPUP:H, PD26:INPUP:H
	# Port C: PC30:INPUP:H
	mww 0x400E1200 0x40000000	;# PIO_PER
	mww 0x400E12A0 0x40000000	;# PIO_OWER
	mww 0x400E1230 0x40000000	;# PIO_SODR
	mww 0x400E1264 0x40000000	;# PIO_PUER
	# Port D: PD26:INPUP:H
	mww 0x400E1400 0x04000000	;# PIO_PER
	mww 0x400E14A0 0x04000000	;# PIO_OWER
	mww 0x400E1430 0x04000000	;# PIO_SODR
	mww 0x400E1464 0x04000000	;# PIO_PUER

	# M24C16, A2=SDA: PD30, A1=SCL: PC31
	# PC31:INPUP:H, PD30:INPUP:H
	# Port C: PC31:INPUP:H
	mww 0x400E1200 0x80000000	;# PIO_PER
	mww 0x400E12A0 0x80000000	;# PIO_OWER
	mww 0x400E1230 0x80000000	;# PIO_SODR
	mww 0x400E1264 0x80000000	;# PIO_PUER
	# Port D: PD30:INPUP:H
	mww 0x400E1400 0x40000000	;# PIO_PER
	mww 0x400E14A0 0x40000000	;# PIO_OWER
	mww 0x400E1430 0x40000000	;# PIO_SODR
	mww 0x400E1464 0x40000000	;# PIO_PUER

	# M24C32, D7=SDA: PA02, A4=SCL: PC13
	# PA02:INPUP:H, PC13:INPUP:H
	# Port A: PA02:INPUP:H
	mww 0x400E0E00 0x00000004	;# PIO_PER
	mww 0x400E0EA0 0x00000004	;# PIO_OWER
	mww 0x400E0E30 0x00000004	;# PIO_SODR
	mww 0x400E0E64 0x00000004	;# PIO_PUER
	# Port C: PC13:INPUP:H
	mww 0x400E1200 0x00002000	;# PIO_PER
	mww 0x400E12A0 0x00002000	;# PIO_OWER
	mww 0x400E1230 0x00002000	;# PIO_SODR
	mww 0x400E1264 0x00002000	;# PIO_PUER

	# M24256, D2=SDA: PA05, A0=SCL: PD26
	# PA05:INPUP:H, PD26:INPUP:H
	# Port A: PA05:INPUP:H
	mww 0x400E0E00 0x00000020	;# PIO_PER
	mww 0x400E0EA0 0x00000020	;# PIO_OWER
	mww 0x400E0E30 0x00000020	;# PIO_SODR
	mww 0x400E0E64 0x00000020	;# PIO_PUER
	# Port D: PD26:INPUP:H
	mww 0x400E1400 0x04000000	;# PIO_PER
	mww 0x400E14A0 0x04000000	;# PIO_OWER
	mww 0x400E1430 0x04000000	;# PIO_SODR
	mww 0x400E1464 0x04000000	;# PIO_PUER

	# AT24C512, A3=SDA: PA19, A1=SCL: PC31
	# PA19:INPUP:H, PC31:INPUP:H
	# Port A: PA19:INPUP:H
	mww 0x400E0E00 0x00080000	;# PIO_PER
	mww 0x400E0EA0 0x00080000	;# PIO_OWER
	mww 0x400E0E30 0x00080000	;# PIO_SODR
	mww 0x400E0E64 0x00080000	;# PIO_PUER
	# Port C: PC31:INPUP:H
	mww 0x400E1200 0x80000000	;# PIO_PER
	mww 0x400E12A0 0x80000000	;# PIO_OWER
	mww 0x400E1230 0x80000000	;# PIO_SODR
	mww 0x400E1264 0x80000000	;# PIO_PUER

	# M24M02, D3=SDA: PA06, A4=SCL: PC13
	# PA06:INPUP:H, PC13:INPUP:H
	# Port A: PA06:INPUP:H
	mww 0x400E0E00 0x00000040	;# PIO_PER
	mww 0x400E0EA0 0x00000040	;# PIO_OWER
	mww 0x400E0E30 0x00000040	;# PIO_SODR
	mww 0x400E0E64 0x00000040	;# PIO_PUER
	# Port C: PC13:INPUP:H
	mww 0x400E1200 0x00002000	;# PIO_PER
	mww 0x400E12A0 0x00002000	;# PIO_OWER
	mww 0x400E1230 0x00002000	;# PIO_SODR
	mww 0x400E1264 0x00002000	;# PIO_PUER

	# MB85RC16, D5=SDA: PD11, A0=SCL: PD26
	# PD26:INPUP:H, PD11:INPUP:H
	# Port D: PD26:INPUP:H, PD11:INPUP:H
	mww 0x400E1400 0x04000800	;# PIO_PER
	mww 0x400E14A0 0x04000800	;# PIO_OWER
	mww 0x400E1430 0x04000800	;# PIO_SODR
	mww 0x400E1464 0x04000800	;# PIO_PUER

	# FM24CL64B, D4=SDA: PD27, A1=SCL: PC31
	# PC31:INPUP:H, PD27:INPUP:H
	# Port C: PC31:INPUP:H
	mww 0x400E1200 0x80000000	;# PIO_PER
	mww 0x400E12A0 0x80000000	;# PIO_OWER
	mww 0x400E1230 0x80000000	;# PIO_SODR
	mww 0x400E1264 0x80000000	;# PIO_PUER
	# Port D: PD27:INPUP:H
	mww 0x400E1400 0x08000000	;# PIO_PER
	mww 0x400E14A0 0x08000000	;# PIO_OWER
	mww 0x400E1430 0x08000000	;# PIO_SODR
	mww 0x400E1464 0x08000000	;# PIO_PUER

	# FM24V02, D6=SDA: PC19, A4=SCL: PC13
	# PC19:INPUP:H, PC13:INPUP:H
	# Port C: PC19:INPUP:H, PC13:INPUP:H
	mww 0x400E1200 0x00082000	;# PIO_PER
	mww 0x400E12A0 0x00082000	;# PIO_OWER
	mww 0x400E1230 0x00082000	;# PIO_SODR
	mww 0x400E1264 0x00082000	;# PIO_PUER

	# AT24MAC402, WP permanently set to '0'
	# PA04:INPUP:H, PA03:INPUP:H, PC11:PPDO:H
	# Port A: PA04:INPUP:H, PA03:INPUP:H
	mww 0x400E0E00 0x00000018	;# PIO_PER
	mww 0x400E0EA0 0x00000018	;# PIO_OWER
	mww 0x400E0E30 0x00000018	;# PIO_SODR
	mww 0x400E0E64 0x00000018	;# PIO_PUER
	# Port C: PC11:PPUP:H
	mww 0x400E1200 0x00000800	;# PIO_PER
	mww 0x400E12A0 0x00000800	;# PIO_OWER
	mww 0x400E1210 0x00000800	;# PIO_OER
	mww 0x400E1234 0x00000800	;# PIO_CODR

	cmspi set 1 m24c04 0x200 0x10 0xAC 1 80
	cmspi set 2 m24c16 0x800 0x10 0xA0 3 80
	cmspi set 3 m24c32 0x1000 0x20 0xAE 0 80
	cmspi set 4 m24256 0x8000 0x40 0xAE 0 80
	cmspi set 5 at24c512 0x10000 0x80 0xAE 0 80
	cmspi set 6 m24m02 0x40000 0x100 0xA8 2 80
	cmspi set 7 mb85rc16 0x800 0x100 0xA0 3 80
	cmspi set 8 fm24cl64 0x2000 0x100 0xAE 0 80
	cmspi set 9 fm24v02 0x8000 0x100 0xAE 0 80
	cmspi set 10 at24mac402 0x100 0x10 0xAE 0 80
	cmspi set 11 at24mac402 0x100 0x10 0xBE 0 80
}

$_TARGETNAME configure -event reset-init {
	cmi2c_init
}


